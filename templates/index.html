<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
    <title>Work Tracker</title>
</head>

<body>
    <header>
        <button id="toggle-mode">Light Mode</button>
    </header>

    <form id="work-entry-form">
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>

        <label for="shift">Shift:</label>
        <select id="shift" name="shift">
            <option value="morning">Morning</option>
            <option value="evening">Evening</option>
            <option value="night">Night</option>
        </select>

        <label for="hours_worked">Hours Worked:</label>
        <input type="number" id="hours_worked" name="hours_worked" step="0.1" required>

        <label for="overtime">Overtime:</label>
        <input type="number" id="overtime" name="overtime" step="0.1">

        <button type="button" id="submit-button">Add Entry</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleButton = document.getElementById('toggle-mode');

            // Setze den gespeicherten Modus (oder Standard: Dark Mode)
            const savedMode = localStorage.getItem('theme') || 'dark-mode';
            document.body.className = savedMode;

            // Setze den Button-Text basierend auf dem Modus
            toggleButton.textContent = savedMode === 'dark-mode' ? 'Light Mode' : 'Dark Mode';

            // Event-Listener für den Button
            toggleButton.addEventListener('click', () => {
                if (document.body.classList.contains('dark-mode')) {
                    document.body.className = 'light-mode';
                    toggleButton.textContent = 'Dark Mode';
                    localStorage.setItem('theme', 'light-mode');
                } else {
                    document.body.className = 'dark-mode';
                    toggleButton.textContent = 'Light Mode';
                    localStorage.setItem('theme', 'dark-mode');
                }
            });
        });


        async function loadWorkEntries() {
            try {
                const response = await fetch('/api/work_entries', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const entries = await response.json();
                    const tableBody = document.getElementById('work-entries');
                    tableBody.innerHTML = ''; // Bestehende Einträge löschen

                    entries.forEach(entry => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td>${entry.date}</td>
                            <td>${entry.shift}</td>
                            <td>${entry.hours_worked}</td>
                            <td>${entry.overtime}</td>
                        `;

                        tableBody.appendChild(row);
                    });
                } else {
                    console.error('Failed to load entries:', response.statusText);
                }
            } catch (error) {
                console.error('Error loading entries:', error);
            }
        }

        // Lade Einträge beim Laden der Seite
        document.addEventListener('DOMContentLoaded', loadWorkEntries);

        document.getElementById("submit-button").addEventListener("click", async function () {
            const form = document.getElementById("work-entry-form");
            const data = {
                date: form.date.value,
                shift: form.shift.value,
                hours_worked: parseFloat(form.hours_worked.value),
                overtime: parseFloat(form.overtime.value || 0) // Standardwert 0, falls leer
            };

            try {
                const response = await fetch("/api/work_entries", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert("Entry added successfully!");
                    form.reset(); // Formular zurücksetzen

                    // Nach erfolgreichem Hinzufügen, Einträge neu laden
                    await loadWorkEntries();
                } else {
                    alert("Failed to add entry: " + response.statusText);
                }
            } catch (error) {
                console.error("Error submitting form:", error);
            }
        });
    </script>

    <h2>Work Entries</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Datum</th>
                <th>Schicht</th>
                <th>Arbeitszeit</th>
                <th>Differenz</th>
            </tr>
        </thead>
        <tbody id="work-entries">
            <!-- Dynamische Daten werden hier eingefügt -->
        </tbody>
    </table>

</body>

</html>
